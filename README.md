<h1 align="center">SDB: High-accuracy stack profiler for Ruby</h1>

# Introduction
SDB provides high-accuracy stack profiling for Ruby applications. It can profile Ruby at **microsecond (0.000001 second)** intervals and offers event tagging for requests.

# Why Do We Need Another Stack Profiler?
1. Minimal Impact: SDB does not affect the target applicationâ€™s performance.
2. Event Tagging: SDB supports event tagging, making it easier to trace and identify slow functions.
3. High Accuracy: SDB offers precision down to microseconds.

Instrumentation libraries like `opentelemetry-ruby` generate data during application runtime, and some stack profilers block application threads. These approaches can introduce delays in your application.

SDB, inspired by [lDB](https://www.usenix.org/conference/nsdi24/presentation/cho#:~:text=LDB%20observes%20the%20latency%20of,costs%20away%20from%20program%20threads.), operates by pulling stack traces on a separate thread, which minimizes the impact on our application.

Event tagging, such as adding trace_id for Puma requests, makes it easier to identify slow functions.

Moreover, SDB can precisely identify delays, down to a single microsecond.

# Usage Example

![Screenshot_2024-09-01_at_17_50_55](https://github.com/user-attachments/assets/d141c45f-19cb-4d30-bcdf-637399e88b25)

The image above is generated by sdb-analyzer. It represents a most simple rails API application rendering an empty body.

From the image, you can clearly see that the `dispatch/middleware/ssl.rb#call` method takes 0.015ms and accounts for 15% of the request delay.

It's because Rails enables force_ssl by default, but the server receives an HTTP request. So, we can remove the SSL middleware if it is not necessary.

# NOTICE
SDB is still in **the experimental stage**. Rather than focusing on ease of use and stability, I am exploring additional use cases, such as detecting concurrency issues or delays caused by GVL.
